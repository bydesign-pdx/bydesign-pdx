var infoBox;var map;var gmarkers=[];var gmarker_index=1;var mapSearchBox;var mcluster;function noo_number_format(d,j,c,b){d=(d+"").replace(/[^0-9+\-Ee.]/g,"");var i=!isFinite(+d)?0:+d,f=!isFinite(+j)?0:Math.abs(j),g=(typeof b==="undefined")?",":b,h=(typeof c==="undefined")?".":c,a="",e=function(o,l){var m=Math.pow(10,l);return""+(Math.round(o*m)/m).toFixed(l)};a=(f?e(i,f):""+Math.round(i)).split(".");if(a[0].length>3){a[0]=a[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)}if((a[1]||"").length<f){a[1]=a[1]||"";a[1]+=new Array(f-a[1].length+1).join("0")}return a.join(h)}(function(b){b.fn.nooLoadmore=function(i,j){var h={agentID:0,contentSelector:null,contentWrapper:null,nextSelector:"div.navigation a:first",navSelector:"div.navigation",itemSelector:"div.post",dataType:"html",finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",loading:{speed:"fast",start:undefined},state:{isDuringAjax:false,isInvalidPage:false,isDestroyed:false,isDone:false,isPaused:false,isBeyondMaxPage:false,currPage:1}};var i=b.extend(h,i);return this.each(function(){var k=this;var q=b(this),r=q.find(".loadmore-wrap"),o=q.find(".loadmore-action"),s=o.find(".btn-loadmore"),n=o.find(".loadmore-loading");i.contentWrapper=i.contentWrapper||r;var p=function(t){if(t.match(/^(.*?)\b2\b(.*?$)/)){t=t.match(/^(.*?)\b2\b(.*?$)/).slice(1)}else{if(t.match(/^(.*?)2(.*?$)/)){if(t.match(/^(.*?page=)2(\/.*|$)/)){t=t.match(/^(.*?page=)2(\/.*|$)/).slice(1);return t}t=t.match(/^(.*?)2(.*?$)/).slice(1)}else{if(t.match(/^(.*?page=)1(\/.*|$)/)){t=t.match(/^(.*?page=)1(\/.*|$)/).slice(1);return t}else{i.state.isInvalidPage=true}}}return t};var l=b(i.nextSelector).attr("href");l=p(l);i.callback=function(t,u){if(j){j.call(b(i.contentSelector)[0],t,i,u)}};i.loading.start=i.loading.start||function(){s.hide();b(i.navSelector).hide();n.show(i.loading.speed,b.proxy(function(){m(i)},k))};var m=function(w){var x=w.callback,t,y,u,z,v;w.state.currPage++;if(w.maxPage!==undefined&&w.state.currPage>w.maxPage){w.state.isBeyondMaxPage=true;return}t=l.join(w.state.currPage);b.post(nooGmapL10n.ajax_url,{action:"noo_agent_ajax_property",page:w.state.currPage,agent_id:w.agentID},function(A){if(A.content!=""&&A.content!=null&&A.content!=undefined){b(w.contentWrapper).append(A.content);n.hide();s.show(w.loading.speed)}else{s.hide();o.append('<div style="margin-top:5px;">'+w.finishedMsg+"</div>").animate({opacity:1},2000,function(){o.fadeOut(w.loading.speed)});return}},"json")};s.on("click",function(t){t.stopPropagation();t.preventDefault();i.loading.start.call(b(i.contentWrapper)[0],i)})})};function f(h){var i=nooGmapL10n.currency_position,j;switch(i){case"left":j="%1$s%2$s";break;case"right":j="%2$s%1$s";break;case"left_space":j="%1$s %2$s";break;case"right_space":j="%2$s %1$s";break}h=noo_number_format(h,nooGmapL10n.num_decimals,nooGmapL10n.decimal_sep,nooGmapL10n.thousands_sep);return j.replace("%1$s",nooGmapL10n.currency).replace("%2$s",h)}function g(){mapSearchBox=b(".noo-map");var s=mapSearchBox.find("#gmap"),v=nooGmapL10n.latitude,u=nooGmapL10n.longitude;if(mapSearchBox.length&&s.length){var A=new google.maps.LatLng(v,u);var j={flat:false,noClear:false,zoom:parseInt(nooGmapL10n.zoom),scrollwheel:false,streetViewControl:false,disableDefaultUI:true,draggable:true,center:A,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(s.get(0),j);google.maps.visualRefresh=true;google.maps.event.addListener(map,"tilesloaded",function(){mapSearchBox.find(".gmap-loading").hide()});var r=document.getElementById("gmap_search_input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(r);var x=new google.maps.places.SearchBox(r);google.maps.event.addListener(x,"places_changed",function(){var E=x.getPlaces();if(E.length==0){return}var B=new google.maps.LatLngBounds();for(var D=0,C;C=E[D];D++){var F=new google.maps.Marker({map:map,zoom:parseInt(nooGmapL10n.zoom),title:C.name,position:C.geometry.location});B.extend(C.geometry.location)}map.fitBounds(B);map.setZoom(parseInt(nooGmapL10n.zoom))});var k={content:document.createElement("div"),disableAutoPan:true,maxWidth:500,boxClass:"myinfobox",zIndex:null,closeBoxMargin:"-13px 0px 0px 0px",closeBoxURL:"",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};infoBox=new InfoBox(k);var t=function(B){var i='<div class="gmap-infobox"><a class="info-close" onclick="return infoBox.close();" href="javascript:void(0)">x</a>          <div class="info-img">'+B.image+'</div>             <div class="info-summary">               <h5 class="info-title">'+B.title+'</h5>               <div class="info-detail">                 <div class="size"><span>'+B.area+'</span></div>                 <div class="bedrooms"><span>'+B.bedrooms+'</span></div>                 <div class="bathrooms"><span>'+B.bathrooms+'</span></div>               </div>              <div class="info-more">                 <div class="info-price">'+B.price_html+'</div>                <div class="info-action"><a href="'+B.url+'"><i class="fa fa-plus"></i></a></div>               </div>            </div>          </div>';infoBox.setContent(i);infoBox.open(map,B);map.setCenter(B.position);map.panBy(50,-120)};if(b(s).data("source")=="IDX"&&(typeof(dsidx)=="object")&&dsidx.dataSets){var n=null;var p=new google.maps.LatLngBounds();b.each(dsidx.dataSets,function(B,C){n=B});for(var w=0;w<dsidx.dataSets[n].length;w++){var q=dsidx.dataSets[n][w];if(q.ShortDescription!==undefined){var o=q.ShortDescription.split(",");var m=o[0]+", "+o[1]}else{var m=q.Address+", "+q.City}var z=new google.maps.LatLng(q.Latitude,q.Longitude);var l=new google.maps.Marker({position:z,map:map,area:q.ImprovedSqFt+" "+nooGmapL10n.area_unit,image:q.PhotoUriBase,title:m,bedrooms:q.BedsShortString,bathrooms:q.BathsShortString,price_html:q.Price,url:nooGmapL10n.home_url+"/idx/"+q.PrettyUriForUrl});l.setIcon(nooGmapL10n.theme_uri+"/assets/images/marker-icon.png");gmarkers.push(l);p.extend(l.getPosition());if(nooGmapL10n.fitbounds){map.fitBounds(p)}google.maps.event.addListener(l,"click",function(i){var B='<div class="gmap-infobox"><a class="info-close" onclick="return infoBox.close();" href="javascript:void(0)">x</a>              <div class="info-img"><img src="'+this.image+'1-full.jpg" style="width:190px;height:160px"/></div>                  <div class="info-summary">                   <h5 class="info-title">'+this.title+'</h5>                  <div class="info-detail">                     <div class="size"><span>'+this.area+'</span></div>                    <div class="bedrooms"><span>'+parseInt(this.bedrooms)+'</span></div>                    <div class="bathrooms"><span>'+parseInt(this.bathrooms)+'</span></div>                  </div>                  <div class="info-more">                     <div class="info-price">'+this.price_html+'</div>                     <div class="info-action"><a href="'+this.url+'"><i class="fa fa-plus"></i></a></div>                  </div>                </div>              </div>';infoBox.setContent(B);infoBox.open(map,this);map.setCenter(this.position);map.panBy(50,-120)})}}else{var h=b.parseJSON(nooGmapL10n.markers);if(h.length){var p=new google.maps.LatLngBounds();for(var w=0;w<h.length;w++){var q=h[w];var z=new google.maps.LatLng(q.latitude,q.longitude);var l=new google.maps.Marker({position:z,map:map,image:q.image,title:q.title,area:q.area,bedrooms:q.bedrooms,bathrooms:q.bathrooms,price:q.price,price_html:q.price_html,url:q.url,category:q.category,status:q.status,sub_location:q.sub_location,location:q.location});if(q.icon!=""){l.setIcon(q.icon)}gmarkers.push(l);p.extend(l.getPosition());if(nooGmapL10n.fitbounds){map.fitBounds(p)}google.maps.event.addListener(l,"click",function(i){t(this)})}}}var y=[{textColor:"#ffffff",opt_textColor:"#ffffff",url:nooGmapL10n.theme_uri+"/assets/images/cloud.png",height:72,width:72,textSize:15}];mcluster=new MarkerClusterer(map,gmarkers,{gridSize:50,ignoreHidden:true,styles:y});mcluster.setIgnoreHidden(true);if(mapSearchBox.find(".zoom-in").length){google.maps.event.addDomListener(mapSearchBox.find(".zoom-in").get(0),"click",function(i){i.stopPropagation();i.preventDefault();var B=parseInt(map.getZoom(),10);B++;if(B>20){B=20}map.setZoom(B)})}if(mapSearchBox.find(".zoom-out").length){google.maps.event.addDomListener(mapSearchBox.find(".zoom-out").get(0),"click",function(i){i.stopPropagation();i.preventDefault();var B=parseInt(map.getZoom(),10);B--;if(B<0){B=0}map.setZoom(B)})}}}google.maps.event.addDomListener(window,"load",g);function c(l){var m={coord:[1,1,1,38,38,59,59,1],type:"poly"};if(map.getZoom()!=15){map.setZoom(15)}var j=new google.maps.LatLng(l.coords.latitude,l.coords.longitude);map.setCenter(j);var i=new google.maps.Marker({position:j,map:map,icon:nooGmapL10n.theme_uri+"/assets/images/my-marker.png",shape:m,zIndex:9999,infoWindowIndex:9999,radius:1000});var k={strokeColor:"#75b08a",strokeOpacity:0.6,strokeWeight:1,fillColor:"#75b08a",fillOpacity:0.2,map:map,center:j,radius:1000};var h=new google.maps.Circle(k)}function d(){alert(nooGmapL10n.no_geolocation_pos)}b(document).on("click",".gmap-mylocation",function(h){h.stopPropagation();h.preventDefault();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(c,d,{timeout:10000})}else{alert(nooGmapL10n.no_geolocation_msg)}});b(document).on("click",".gmap-full",function(h){h.stopPropagation();h.preventDefault();if(b(this).closest(".noo-map").hasClass("fullscreen")){b(this).closest(".noo-map").removeClass("fullscreen");b(this).empty().html('<i class="fa fa-expand"></i> '+nooGmapL10n.fullscreen_label)}else{b(this).closest(".noo-map").addClass("fullscreen");b(this).empty().html('<i class="fa fa-compress"></i> '+nooGmapL10n.default_label)}google.maps.event.trigger(map,"resize")});b(document).on("click",".gmap-prev",function(h){h.stopPropagation();h.preventDefault();gmarker_index--;if(gmarker_index<1){gmarker_index=gmarkers.length}while(gmarkers[gmarker_index-1].visible===false){gmarker_index--;if(gmarker_index>gmarkers.length){gmarker_index=1}}if(map.getZoom()<15){map.setZoom(15)}google.maps.event.trigger(gmarkers[gmarker_index-1],"click")});b(document).on("click",".gmap-next",function(h){h.stopPropagation();h.preventDefault();gmarker_index++;if(gmarker_index>gmarkers.length){gmarker_index=1}while(gmarkers[gmarker_index-1].visible===false){gmarker_index++;if(gmarker_index>gmarkers.length){gmarker_index=1}}if(map.getZoom()<15){map.setZoom(15)}google.maps.event.trigger(gmarkers[gmarker_index-1],"click")});function a(){var k=b(".property-map-box"),o,l=k.data("latitude"),m=k.data("longitude");if(k.length){var i=new google.maps.LatLng(l,m);var h=new google.maps.Map(k.get(0),{flat:false,noClear:false,zoom:16,scrollwheel:false,draggable:true,center:i,streetViewControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP});var j=new google.maps.Marker({icon:nooGmapL10n.theme_uri+"/assets/images/marker-icon.png",position:i,map:h});var n=(document.getElementById("property_map_search_input"));h.controls[google.maps.ControlPosition.TOP_LEFT].push(n);var p=new google.maps.places.SearchBox((n));google.maps.event.addListener(p,"places_changed",function(){if(o!=null){o.setMap(null)}var q=new google.maps.Geocoder();var r=function(t){q.geocode({latLng:t},function(u,v){if(v==google.maps.GeocoderStatus.OK){if(u[0]){return u[0].formatted_address}}})};var s=r(i);q.geocode({address:n.value},function(v,u){if(u==google.maps.GeocoderStatus.OK){h.setCenter(v[0].geometry.location);o=new google.maps.Marker({position:v[0].geometry.location,map:h,draggable:false,animation:google.maps.Animation.DROP});var w=n.value;var x=i;var t=new google.maps.DirectionsService();var y=new google.maps.DirectionsRenderer();y.setMap(h);var z={origin:w,destination:x,travelMode:google.maps.TravelMode.DRIVING};t.route(z,function(A,B){if(B==google.maps.DirectionsStatus.OK){y.setDirections(A)}})}else{alert("Geocode was not successful for the following reason: "+u)}})})}}google.maps.event.addDomListener(window,"load",a);function e(){b(".noo_advanced_search_property").each(function(){var q=b(this);if(q.find("#gmap").length){var u=q.find("input.glocation_input").length>0?q.find("input.glocation_input").val():"",k=q.find("input.gsub_location_input").length>0?q.find("input.gsub_location_input").val():"",t=q.find("input.gstatus_input").length>0?q.find("input.gstatus_input").val():"",n=q.find("input.gcategory_input").length>0?q.find("input.gcategory_input").val():"",s=q.find("input.gbedroom_input").length>0?q.find("input.gbedroom_input").val():"",r=q.find("input.gbathroom_input").length>0?q.find("input.gbathroom_input").val():"",j=q.find("input.gprice_min").length>0?q.find("input.gprice_min").val():0,o=q.find("input.gprice_max").length>0?q.find("input.gprice_max").val():0,v=q.find("input.garea_min").length>0?q.find("input.garea_min").val():0,p=q.find("input.garea_max").length>0?q.find("input.garea_max").val():0;if(typeof infoBox!=="undefined"&&infoBox!==null){infoBox.close()}var m=new google.maps.LatLngBounds();if(typeof mcluster!=="undefined"){mcluster.setIgnoreHidden(true)}if(gmarkers.length){for(var h=0;h<gmarkers.length;h++){var l=gmarkers[h];if(l.location!==u&&u!=""){l.setVisible(false)}else{if(l.sub_location!==k&&k!=""){l.setVisible(false)}else{if(l.status!==t&&t!=""){l.setVisible(false)}else{if(l.category!==n&&n!=""){l.setVisible(false)}else{if(l.bedrooms!==s&&s!=""){l.setVisible(false)}else{if(l.bathrooms!==r&&r!=""){l.setVisible(false)}else{if(parseFloat(l.price)<parseFloat(j)&&parseFloat(j)>0){l.setVisible(false)}else{if(parseFloat(l.price)>parseFloat(o)&&parseFloat(o)>0){l.setVisible(false)}else{if(parseInt(l.area)<parseInt(v)&&parseInt(v)>0){l.setVisible(false)}else{if(parseInt(l.area)>parseInt(p)&&parseInt(p)>0){l.setVisible(false)}else{l.setVisible(true);m.extend(l.getPosition())}}}}}}}}}}}if(typeof mcluster!=="undefined"){mcluster.repaint()}}map.setZoom(10);if(!m.isEmpty()){map.fitBounds(m)}}})}b(document).ready(function(){if(b(".gsearch").length){b(".gsearch").find(".dropdown-menu > li > a").on("click",function(s){s.stopPropagation();s.preventDefault();var r=b(this).closest(".dropdown"),t=b(this).data("value");r.children("input").val(t);r.children("input").trigger("change");r.children('[data-toggle="dropdown"]').text(b(this).text());r.children('[data-toggle="dropdown"]').dropdown("toggle")});if(b(".noo-map").length){b(".noo-map").each(function(){if(!b(this).hasClass("no-gmap")){b(this).find(".gsearch").find(".gsearch-field").find('input[type="hidden"]').on("change",function(){e()})}})}}if(b(".gprice").length){var i=b(".gprice"),l=i.find(".gprice_min").data("min"),p=i.find(".gprice_max").data("max"),j=i.find(".gprice_min").val(),h=i.find(".gprice_max").val();i.find(".gprice-slider-range").slider({range:true,animate:true,min:l,max:p,values:[j,h],create:function(s,r){var t=b(this).find("a.ui-slider-handle");b(t[0]).tooltip({title:f(j),placement:"bottom",container:"body"});b(t[1]).tooltip({title:f(h),placement:"bottom",container:"body"})},slide:function(s,r){i.find("input.gprice_min").val(r.values[0]);i.find("input.gprice_min").trigger("change");i.find("input.gprice_max").val(r.values[1]);i.find("input.gprice_max").trigger("change");var t=b(this).find("a.ui-slider-handle");b(t[0]).tooltip("destroy").tooltip({title:f(r.values[0]),placement:"bottom",container:"body"});b(t[1]).tooltip("destroy").tooltip({title:f(r.values[1]),placement:"bottom",container:"body"})}})}if(b(".garea").length){var m=b(".garea"),q=m.find(".garea_min").data("min"),k=m.find(".garea_max").data("max"),o=m.find(".garea_min").val(),n=m.find(".garea_max").val();m.find(".garea-slider-range").slider({range:true,animate:true,min:q,max:k,values:[o,n],create:function(s,r){var t=b(this).find("a.ui-slider-handle");b(t[0]).tooltip({title:o+" "+nooGmapL10n.area_unit,placement:"bottom",container:"body"});b(t[1]).tooltip({title:n+" "+nooGmapL10n.area_unit,placement:"bottom",container:"body"})},slide:function(s,r){m.find("input.garea_min").val(r.values[0]);m.find("input.garea_min").trigger("change");m.find("input.garea_max").val(r.values[1]);m.find("input.garea_max").trigger("change");var t=b(this).find("a.ui-slider-handle");b(t[0]).tooltip("destroy").tooltip({title:r.values[0]+" "+nooGmapL10n.area_unit,placement:"bottom",container:"body"});b(t[1]).tooltip("destroy").tooltip({title:r.values[1]+" "+nooGmapL10n.area_unit,placement:"bottom",container:"body"})}})}})})(jQuery);